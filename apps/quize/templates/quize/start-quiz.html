{% extends "attempt-base.html" %}
{% load static %}
{% block content %}

<style>
    /* Option Card Styling */
    .option-card {
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .my-option-card.selected {
        border: solid 2px #28a745;
    }

    .option-card:hover {
        transform: scale(1.05);
    }

    .card {
        border: 1px solid #ddd;
    }

    .card-body {
        padding: 20px;
    }

    .card-img-top {
        max-height: 200px;
        object-fit: cover;
    }

    .card-title {
        font-size: 1.2rem;
        font-weight: 600;
    }

    /* Border Green on Selection */
    .option-card.selected {
        border: 2px solid #28a745 !important; /* Green Border */
        box-shadow: 0 0 15px rgba(40, 167, 69, 0.5); /* Green shadow */
    }

    /* Fade-in Effect */
    .option-card {
        opacity: 0;
        animation: fadeIn 0.5s forwards;
    }

    @keyframes fadeIn {
        0% {
            opacity: 0;
        }

        100% {
            opacity: 1;
        }
    }

    /* Style the checked checkbox */
    input[type="checkbox"]:checked {
        background-color: #28a745 !important;
        border-color: #28a745 !important;
    }

    /* Optional: Customize the appearance of the radio and checkbox for better look */
    input[type="checkbox"],
    input[type="radio"] {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        border: 2px solid #ccc;
        outline: none;
        transition: all 0.3s ease;
    }

    /* If you want a more custom look, you can create a circular green checked effect */
    input[type="checkbox"]:checked,
    input[type="radio"]:checked {
        background-color: #28a745;
        border-color: #28a745;
    }

    .form-control {
        font-size: 30px;
        padding: 20px;
    }
</style>

<div class="nk-content-wrap">
    <div class="container text-left">
        <div class="mt-5">
            <h2 class="text-primary my-4">Quiz: {{ quiz.title }}</h2>
            <img src="{% static 'assets/images/step.png' %}" class="my-5" alt="Quiz Progress">

            <form method="post" action="{% url 'submit-quiz' quiz.id %}" id="quiz-form">
                {% csrf_token %}

                {% for question in questions %}
                <div class="my-5">
                    <h5 class="text-muted">Question {{ forloop.counter }}</h5>
                    <h3 class="text-secondary my-4">{{ question.question_text }} {% if question.question_type == "checkboxes" %}(Select all that apply){% endif %}</h3>

                    {% if question.question_type == "checkboxes" %}
                    <!-- Checkboxes -->
                    <div class="row">
                        {% for option in question.options.all %}
                        <div class="{% if option.image %}col-sm-3 col-md-3{% else %}col-12 col-md-12{% endif %} mb-3 option-card" id="option-{{ option.id }}">
                            <label for="question-{{ question.id }}-option-{{ option.id }}" class="form-check-label card shadow-sm rounded my-option-card">
                                {% if option.image %}
                                <img src="{{ option.image.url }}" class="card-img-top" alt="Option Image">
                                {% endif %}
                                <div class="card-body text-left">
                                    <div class="form-check d-flex align-items-center">
                                        <input 
                                            class="checkbox-input form-check-input my-0" 
                                            type="checkbox" 
                                            id="question-{{ question.id }}-option-{{ option.id }}" 
                                            name="question_{{ question.id }}[]" 
                                            value="{{ option.id }}">
                                        
                                        <label class="form-check-label my-0 mx-3" for="question-{{ question.id }}-option-{{ option.id }}">
                                            <h5 class="card-title my-0 py-0">{{ option.text }}</h5>
                                        </label>
                                    </div>
                                </div>
                            </label>
                        </div>
                        {% endfor %}
                    </div>

                    {% elif question.question_type == "radio" %}
                    <!-- Radio Buttons -->
                    <div class="row">
                        {% for option in question.options.all %}
                        <div class="{% if option.image %}col-sm-3 col-md-3{% else %}col-12 col-md-12{% endif %} mb-3 option-card" id="option-{{ option.id }}">
                            <label for="question-{{ question.id }}-option-{{ option.id }}" class="card shadow-sm my-option-card form-check-label">
                                {% if option.image %}
                                    <img src="{{ option.image.url }}" class="card-img-top" alt="Option Image">
                                {% endif %}

                                <div class="card-body text-left">
                                    <div class="form-check">
                                        <input 
                                            class="form-check-input" 
                                            type="radio" 
                                            id="question-{{ question.id }}-option-{{ option.id }}" 
                                            name="question_{{ question.id }}" 
                                            value="{{ option.id }}" 
                                            required>
    
                                        <label class="form-check-label mx-3" for="question-{{ question.id }}-option-{{ option.id }}">
                                            <h5 class="card-title my-0 py-0">{{ option.text }}</h5>
                                        </label>
                                    </div>
                                </div>
                            </label>
                        </div>
                        {% endfor %}
                    </div>

                    {% elif question.question_type == "text" %}
                    <!-- Text Input -->
                    <div>
                        <input 
                            type="text" 
                            class="form-control form-control-lg" 
                            id="question-{{ question.id }}" 
                            name="question_{{ question.id }}" 
                            placeholder="Enter your answer here" 
                            required>
                    </div>

                    {% elif question.question_type == "number" %}
                    <!-- Number Input -->
                    <div>
                        <input 
                            type="number" 
                            class="form-control form-control-lg" 
                            id="question-{{ question.id }}" 
                            name="question_{{ question.id }}" 
                            placeholder="Enter a number"
                            min="0"
                            required>
                    </div>

                    {% endif %}
                </div>
                {% endfor %}



                  <!-- Manual Questions -->
                  <div class="my-5">
                    <h5 class="text-muted">Almost Done</h5>
                    <h3 class="text-secondary my-4">Your Full Name</h3>
                    <div>
                        <input 
                            type="text" 
                            class="form-control form-control-lg" 
                            id="full_name" 
                            name="full_name" 
                            placeholder="Enter your full name" 
                            required>
                    </div>
                </div>

                <div class="my-5">
                    <h5 class="text-muted">Just 1 Step</h5>
                    <h3 class="text-secondary my-4">Email Address</h3>
                    <div>
                        <input 
                            type="email" 
                            class="form-control form-control-lg" 
                            id="email" 
                            name="email" 
                            placeholder="Enter your email address" 
                            required>
                    </div>
                </div>



                <div class="mt-5 d-flex justify-content-between">
                    <a href="{% url 'start-quiz' quiz.id %}" class="btn btn-secondary btn-lg">Back</a>
                    <button type="submit" class="btn btn-primary btn-lg mx-2">Submit Quiz</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
    // Toggle selected class on checkbox/radio
    $(".form-check-input").on("click", function () {
        let clicked_input_status = this.checked;
        let clicked_input = $(this);

        // Handle Checkbox
        if (clicked_input.attr("type") === "checkbox") {
            if (clicked_input_status) {
                clicked_input.closest('.form-check').parent().parent().addClass("selected");
            } else {
                clicked_input.closest('.form-check').parent().parent().removeClass("selected");
            }
        }

        // Handle Radio Button
        if (clicked_input.attr("type") === "radio") {
            clicked_input.closest('.form-check').parent().parent().addClass("selected");
            $("input[name='" + clicked_input.attr("name") + "']").not(clicked_input).each(function () {
                $(this).closest('.form-check').parent().parent().removeClass("selected");
            });
        }
    });

});

</script>
{% endblock %}
